name: Update MC Verification
on:
  repository_dispatch:
    types: [verify_mc_event]

permissions:
  contents: write

jobs:
  update-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Replace Meta Tag Content
        run: |
          # 1. Delete any existing verification lines
          sed -i '/google-site-verification/d' index.html
          
          # 2. Force insert at the top of the file (after the first line)
          # This is safer than looking for </head>
          sed -i "2i <meta name=\"google-site-verification\" content=\"${{ github.event.client_payload.mc_code }}\" />" index.html
      - name: Debug - Show file content
        run: |
          echo "Checking if the tag was updated in index.html:"
          grep "google-site-verification" index.html

      - name: Commit and Push
        run: |
          git config --global user.name "Automation Bot"
          git config --global user.email "bot@test.com"
          git add index.html
          # commit will only run if there are actual changes
          git commit -m "Updated MC Tag to ${{ github.event.client_payload.mc_code }}" || echo "No changes detected"
          git push
